# lua_cpp Development Guidelines

Auto-generated from all feature plans. Last updated: 2025-09-25

## Project Overview

**ç°ä»£C++ç‰ˆLua 5.1.5è§£é‡Šå™¨** - åŸºäºSpecification-Driven Developmentæ„å»ºçš„ä¼ä¸šçº§Luaè§£é‡Šå™¨

- **é¡¹ç›®çŠ¶æ€**: å®ç°é˜¶æ®µ 36.2% (21/58ä»»åŠ¡å®Œæˆ)
- **å½“å‰é‡ç‚¹**: T022 Parseræ ¸å¿ƒåŠŸèƒ½å®ç°
- **Spec-Kitç‰ˆæœ¬**: v0.0.17 (æ”¯æŒ `/clarify` å’Œ `/analyze` å‘½ä»¤)
- **å¼€å‘æ–¹æ³•è®º**: SDD + åŒé‡å‚è€ƒé¡¹ç›®éªŒè¯

## Active Technologies

### Core Stack
- **Language**: C++17/20 (ç°ä»£C++ç‰¹æ€§ä¼˜å…ˆ)
- **Build System**: CMake 3.16+
- **Testing**: Catch2 + Google Benchmark
- **Quality**: Clang-format, Clang-tidy, é™æ€åˆ†æ

### Architecture Components
- **è¯æ³•åˆ†æå™¨**: å®Œæˆ (Tokenç³»ç»Ÿ + Lexer + é”™è¯¯å¤„ç†)
- **è¯­æ³•åˆ†æå™¨**: è¿›è¡Œä¸­ (ASTåŸºç¡€å®Œæˆï¼ŒParserå®ç°ä¸­)
- **åƒåœ¾æ”¶é›†å™¨**: ç‹¬ç«‹å®Œæˆ (ä¸‰è‰²æ ‡è®°ï¼Œ0.55msæ”¶é›†æ—¶é—´)
- **è™šæ‹Ÿæœº**: è®¾è®¡é˜¶æ®µ
- **C API**: å¥‘çº¦å®Œæˆï¼Œå®ç°å¾…å¼€å§‹

## Project Structure

```
lua_cpp/
â”œâ”€â”€ memory/constitution.md      # é¡¹ç›®å®ªæ³•å’Œæ ¸å¿ƒåŸåˆ™
â”œâ”€â”€ specs/                      # è§„æ ¼æ–‡æ¡£ (SDDæ–¹æ³•è®º)
â”œâ”€â”€ src/                        # æºä»£ç å®ç°
â”‚   â”œâ”€â”€ lexer/                 # âœ… è¯æ³•åˆ†æå™¨ (å®Œæˆ)
â”‚   â”œâ”€â”€ parser/                # ğŸ”„ è¯­æ³•åˆ†æå™¨ (è¿›è¡Œä¸­)
â”‚   â”œâ”€â”€ memory/                # âœ… åƒåœ¾æ”¶é›†å™¨ (å®Œæˆ)
â”‚   â”œâ”€â”€ types/                 # âœ… æ ¸å¿ƒç±»å‹ (å®Œæˆ)
â”‚   â”œâ”€â”€ vm/                    # â³ è™šæ‹Ÿæœº (å¾…å¼€å§‹)
â”‚   â””â”€â”€ api/                   # â³ C API (å¾…å¼€å§‹)
â”œâ”€â”€ tests/                     # æµ‹è¯•å¥—ä»¶
â”‚   â”œâ”€â”€ contract/              # âœ… å¥‘çº¦æµ‹è¯• (17ä¸ªå®Œæˆ)
â”‚   â”œâ”€â”€ unit/                  # ğŸ”„ å•å…ƒæµ‹è¯• (éƒ¨åˆ†)
â”‚   â””â”€â”€ integration/           # âœ… é›†æˆæµ‹è¯• (å®Œæˆ)
â”œâ”€â”€ commands/                  # Spec-Kitå‘½ä»¤
â”‚   â”œâ”€â”€ clarify.md            # æ¾„æ¸…å‘½ä»¤ (æ–°å¢)
â”‚   â””â”€â”€ analyze.md            # åˆ†æå‘½ä»¤ (æ–°å¢)
â””â”€â”€ docs/                     # é¡¹ç›®æ–‡æ¡£
```

## Available Commands (Spec-Kit SDD)

### Primary SDD Workflow
```bash
/constitution  # å»ºç«‹/æ›´æ–°é¡¹ç›®åŸåˆ™ (âœ… å·²å»ºç«‹)
/specify      # åˆ›å»ºåŠŸèƒ½è§„æ ¼ (âœ… å·²å®Œæˆ)
/clarify      # æ¾„æ¸…æ­§ä¹‰åŒºåŸŸ (ğŸ†• æ–°å¢åŠŸèƒ½)
/plan         # æŠ€æœ¯å®ç°è®¡åˆ’ (âœ… å·²å®Œæˆ)
/tasks        # ç”Ÿæˆä»»åŠ¡åˆ—è¡¨ (âœ… å·²å®Œæˆ)
/analyze      # è´¨é‡ä¸€è‡´æ€§åˆ†æ (ğŸ†• æ–°å¢åŠŸèƒ½)
/implement    # æ‰§è¡Œå®æ–½ (ğŸ”„ å½“å‰é˜¶æ®µ)
```

### Specialized Commands for lua_cpp
- **å‚è€ƒé¡¹ç›®éªŒè¯**: æ¯ä¸ªå®ç°éƒ½éœ€è¦ lua_c_analysis è¡Œä¸ºéªŒè¯ + lua_with_cpp è´¨é‡éªŒè¯
- **å®ªæ³•åˆè§„æ£€æŸ¥**: æ‰€æœ‰æŠ€æœ¯å†³ç­–å¿…é¡»ç¬¦åˆé¡¹ç›®å®ªæ³•åŸåˆ™
- **ç°ä»£C++æ ‡å‡†**: å……åˆ†åˆ©ç”¨C++17/20ç‰¹æ€§ï¼ŒRAIIï¼Œæ™ºèƒ½æŒ‡é’ˆ

## Current Development Context

### ğŸ¯ **å½“å‰ä»»åŠ¡**: T022 Parseræ ¸å¿ƒåŠŸèƒ½å®ç°

**å‡†å¤‡å·¥ä½œ** (å·²å®Œæˆ):
- âœ… ASTèŠ‚ç‚¹å®šä¹‰ (`src/parser/ast.h` - 941è¡Œ)
- âœ… ASTå®ç° (`src/parser/ast.cpp` - 815è¡Œ)  
- âœ… Parseræ¥å£è®¾è®¡ (`src/parser/parser.h`)
- âœ… Lexerå®Œæ•´å®ç° (Token + æ ¸å¿ƒåŠŸèƒ½ + é”™è¯¯å¤„ç†)

**å½“å‰éœ€è¦**:
- ğŸ¯ é€’å½’ä¸‹é™è§£æå™¨å®ç°
- ğŸ¯ è¡¨è¾¾å¼è§£æ (è¿ç®—ç¬¦ä¼˜å…ˆçº§)
- ğŸ¯ è¯­å¥è§£æ (æ§åˆ¶æµã€å‡½æ•°å®šä¹‰)
- ğŸ¯ ä¸ASTå’ŒLexerçš„é›†æˆ

**å‚è€ƒèµ„æ–™**:
- å¥‘çº¦æµ‹è¯•: `tests/contract/test_parser_contract.cpp` (1,900+è¡Œ)
- åŸç‰ˆå‚è€ƒ: `lua_c_analysis/src/lparser.c`
- ç°ä»£å®ç°: `lua_with_cpp/src/parser/`

### ğŸ“Š **é¡¹ç›®è¿›åº¦æ€»è§ˆ**

```
æ€»ä½“è¿›åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 36.2% (21/58)

âœ… å¥‘çº¦æµ‹è¯•é˜¶æ®µ: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100% (17/17)
ğŸš§ å®ç°é˜¶æ®µ: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  9.8% (4/41)
  â”œâ”€ è¯æ³•åˆ†æå™¨: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100% (3/3)
  â”œâ”€ è¯­æ³•åˆ†æå™¨: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  25% (1/4)
  â””â”€ æ ¸å¿ƒç»„ä»¶  : â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  25% (1/4)
```

## Code Style & Quality Standards

### C++ Standards
```cpp
// ç°ä»£C++ç‰¹æ€§åº”ç”¨ç¤ºä¾‹
class Parser {
    std::unique_ptr<AST> parseExpression();  // æ™ºèƒ½æŒ‡é’ˆ
    [[nodiscard]] bool tryParse() const;     // C++17å±æ€§
    
    template<typename T>
    constexpr auto getValue() -> decltype(auto) { // C++14/17ç‰¹æ€§
        return std::forward<T>(value);
    }
};
```

### Quality Requirements
- **æµ‹è¯•è¦†ç›–ç‡**: â‰¥90%
- **ç¼–è¯‘æ ‡å‡†**: é›¶è­¦å‘Š (æœ€ä¸¥æ ¼è­¦å‘Šçº§åˆ«)
- **å†…å­˜å®‰å…¨**: Valgrind + AddressSanitizeréªŒè¯
- **æ€§èƒ½åŸºå‡†**: â‰¥95% lua_c_analysisæ€§èƒ½
- **å…¼å®¹æ€§**: 100% Lua 5.1.5å…¼å®¹

### Reference Project Integration
```cpp
// å¼€å‘æ¨¡å¼ï¼šåŒé‡éªŒè¯
void implementFeature() {
    // 1. ç ”ä¹  lua_c_analysis å®ç°åŸç†
    // 2. å‚è€ƒ lua_with_cpp æ¶æ„è®¾è®¡  
    // 3. ç°ä»£C++å®ç°
    // 4. è¡Œä¸ºéªŒè¯ + è´¨é‡éªŒè¯
}
```

## Recent Changes & Completed Features

### æœ€è¿‘å®Œæˆ (2025-09-25)
1. **T020 Lexeré”™è¯¯å¤„ç†** - å®Œæ•´é”™è¯¯å¤„ç†ç³»ç»Ÿ
   - 25+é”™è¯¯ç±»å‹ï¼Œ8ç§æ¢å¤ç­–ç•¥
   - ç”¨æˆ·å‹å¥½é”™è¯¯æ¶ˆæ¯å’Œä¿®å¤å»ºè®®
   - å®ç°æ–‡ä»¶: `src/lexer/lexer_errors.h/cpp`

2. **T021 ASTåŸºç¡€æ¶æ„** - è¯­æ³•æ ‘èŠ‚ç‚¹ç³»ç»Ÿ
   - 30+ASTèŠ‚ç‚¹ç±»å‹ï¼Œè®¿é—®è€…æ¨¡å¼
   - ç°ä»£C++ç‰¹æ€§åº”ç”¨ (æ™ºèƒ½æŒ‡é’ˆã€RAII)
   - å®ç°æ–‡ä»¶: `src/parser/ast.h/cpp`

3. **T023 åƒåœ¾æ”¶é›†å™¨** - ç‹¬ç«‹GCå®ç°  
   - ä¸‰è‰²æ ‡è®°ç®—æ³•ï¼Œå¢é‡æ”¶é›†
   - æ€§èƒ½: 294ä¸‡å¯¹è±¡/ç§’ï¼Œ0.55msæ”¶é›†æ—¶é—´
   - å®ç°æ–‡ä»¶: `src/memory/garbage_collector.h/cpp`

### æŠ€æœ¯æ ˆæ¼”è¿›
- **Spec-Kitå‡çº§**: v0.0.17 (æ–°å¢ `/clarify` å’Œ `/analyze`)
- **å·¥ä½œæµç¨‹æ ‡å‡†åŒ–**: 7æ­¥SDDæµç¨‹
- **è´¨é‡é—¨ç¦å¼ºåŒ–**: è·¨æ–‡æ¡£ä¸€è‡´æ€§éªŒè¯

## ğŸš€ **Quick Start for New AI Sessions**

### ç«‹å³å¯æ‰§è¡Œçš„æ“ä½œ

1. **äº†è§£å½“å‰çŠ¶æ€**
   ```bash
   # æŸ¥çœ‹é¡¹ç›®æ¦‚å†µ
   cat README.md | head -50
   
   # æŸ¥çœ‹å½“å‰ä»»åŠ¡
   cat TODO.md | grep -A 10 "T022"
   
   # æŸ¥çœ‹æœ€æ–°è¿›å±•  
   cat PROJECT_DASHBOARD.md | head -30
   ```

2. **æ£€æŸ¥T022å‡†å¤‡æƒ…å†µ**
   ```bash
   # æŸ¥çœ‹ASTå®šä¹‰
   code src/parser/ast.h
   
   # æŸ¥çœ‹Parseræ¥å£
   code src/parser/parser.h
   
   # æŸ¥çœ‹å¥‘çº¦æµ‹è¯•
   code tests/contract/test_parser_contract.cpp
   ```

3. **ä½¿ç”¨Spec-Kitå‘½ä»¤ (å¦‚æœ‰éœ€è¦)**
   ```bash
   /clarify   # æ¾„æ¸…Parserå®ç°çš„æ­§ä¹‰ç‚¹
   /analyze   # éªŒè¯æ–‡æ¡£ä¸€è‡´æ€§
   /implement # å¼€å§‹T022å®æ–½
   ```

## Next Immediate Actions

### å¯¹äºæ–°AIä¼šè¯ï¼Œå»ºè®®æŒ‰æ­¤é¡ºåºï¼š

1. **ğŸ” å¿«é€Ÿç†è§£** (2åˆ†é’Ÿ)
   - é˜…è¯»æœ¬æ–‡æ¡£è·å¾—é¡¹ç›®å…¨è²Œ
   - æ£€æŸ¥ `TODO.md` äº†è§£å½“å‰ä»»åŠ¡çŠ¶æ€
   - æŸ¥çœ‹ `PROJECT_DASHBOARD.md` è·å–æœ€æ–°è¿›å±•

2. **ğŸ“‹ éªŒè¯å‡†å¤‡** (3åˆ†é’Ÿ)  
   - ç¡®è®¤T022çš„å‰ç½®æ¡ä»¶éƒ½å·²æ»¡è¶³
   - æ£€æŸ¥ç›¸å…³æºæ–‡ä»¶å’Œæµ‹è¯•æ–‡ä»¶å­˜åœ¨æ€§
   - éªŒè¯å¼€å‘ç¯å¢ƒé…ç½®å®Œæ•´æ€§

3. **ğŸ¯ å¼€å§‹å¼€å‘** (ç«‹å³)
   - å¦‚æœ‰ç–‘é—®å…ˆè¿è¡Œ `/clarify` æ¾„æ¸…
   - ä½¿ç”¨ `/analyze` éªŒè¯ä¸€è‡´æ€§  
   - æ‰§è¡Œ `/implement` å¼€å§‹T022å®æ–½
   - éµå¾ªTDDï¼šæµ‹è¯•å…ˆè¡Œï¼Œå‚è€ƒé¡¹ç›®éªŒè¯

### T022 Parserå…·ä½“å®æ–½æŒ‡å¯¼

**å®ç°æ–‡ä»¶**: `src/parser/parser.cpp`
**æµ‹è¯•æ–‡ä»¶**: `tests/unit/test_parser.cpp` (åŸºäºcontract)
**å‚è€ƒ**: `tests/contract/test_parser_contract.cpp` (1,900è¡Œè§„æ ¼)

**å…³é”®å®ç°ç‚¹**:
- é€’å½’ä¸‹é™è§£æå™¨æ¨¡å¼
- è¿ç®—ç¬¦ä¼˜å…ˆçº§å¤„ç†
- é”™è¯¯æ¢å¤å’ŒæŠ¥å‘Š
- ASTèŠ‚ç‚¹æ„å»º
- ä¸Lexeræ— ç¼é›†æˆ

---

<!-- MANUAL ADDITIONS START -->
**é¡¹ç›®ç‰¹è‰²**: 
- Specification-Driven Development (SDD)
- åŒé‡å‚è€ƒé¡¹ç›®éªŒè¯ (lua_c_analysis + lua_with_cpp)  
- ç°ä»£C++ä¼ä¸šçº§è´¨é‡æ ‡å‡†
- å®Œæ•´çš„æµ‹è¯•é©±åŠ¨å¼€å‘æµç¨‹
<!-- MANUAL ADDITIONS END -->